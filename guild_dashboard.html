<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>cherry server settings</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="guild_dashboard.css" />
</head>
<body>
    <header>
        <img src="bot-avatar.jpg" alt="cherrybot avatar" class="bot-avatar" />
        <h1>server settings</h1>
        <p>customize cherry for your server</p>
    </header>

    <nav>
        <ul class="nav-list">
            <li><a href="index.html">home</a></li>
            <li><a href="commands.html">commands</a></li>
            <li><a href="dashboard.html">dashboard</a></li>
            <li><a href="premium.html">premium</a></li>
            <li><a href="faq.html">faq</a></li>
            <li><a href="https://discord.gg/cheriez" target="_blank">support</a></li>
        </ul>
    </nav>

    <main id="main-content">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading...</p>
        </div>
    </main>

    <footer>
        <p>made with care by chérie</p>
    </footer>

    <script>
        function showGuildSettings(guildData) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="guild-dashboard">
                    <a href="dashboard.html" class="back-button">
                        ← Back to Dashboard
                    </a>

                    <div class="guild-info">
                        <img src="${guildData.icon 
                            ? `https://cdn.discordapp.com/icons/${guildData.id}/${guildData.icon}.png` 
                            : 'bot-avatar.jpg'}" 
                            alt="${guildData.name}" class="server-icon">
                        <h2>${guildData.name}</h2>
                    </div>

                    <div class="settings-grid">
                        <!-- Welcome Messages -->
                        <div class="settings-card">
                            <h3>Welcome Messages</h3>
                            <div class="setting-group">
                                <label for="welcome-enabled">Enable Welcome Messages</label>
                                <input type="checkbox" id="welcome-enabled" name="welcome-enabled">
                            </div>
                            <div class="setting-group">
                                <label for="welcome-channel">Welcome Channel</label>
                                <select id="welcome-channel" name="welcome-channel">
                                    <option value="">Select a channel</option>
                                </select>
                                <div class="setting-help">Choose the channel where welcome messages will be sent</div>
                            </div>
                            <div class="setting-group">
                                <label for="welcome-message">Welcome Message</label>
                                <textarea id="welcome-message" name="welcome-message" rows="3" 
                                    placeholder="Welcome {user} to {server}!"></textarea>
                                <div class="setting-help">Use {user} for username and {server} for server name</div>
                            </div>
                        </div>

                        <!-- Auto Roles -->
                        <div class="settings-card">
                            <h3>Auto Roles</h3>
                            <div class="setting-group">
                                <label for="autorole-enabled">Enable Auto Roles</label>
                                <input type="checkbox" id="autorole-enabled" name="autorole-enabled">
                            </div>
                            <div class="setting-group">
                                <label for="autorole-roles">Auto-assign Roles</label>
                                <select id="autorole-roles" name="autorole-roles" multiple>
                                    <option value="">Loading roles...</option>
                                </select>
                                <div class="setting-help">Select roles to automatically assign to new members</div>
                            </div>
                        </div>

                        <!-- Moderation -->
                        <div class="settings-card">
                            <h3>Moderation Settings</h3>
                            <div class="setting-group">
                                <label for="mod-log-channel">Moderation Log Channel</label>
                                <select id="mod-log-channel" name="mod-log-channel">
                                    <option value="">Select a channel</option>
                                </select>
                            </div>
                            <div class="setting-group">
                                <label for="auto-mod">Auto Moderation</label>
                                <input type="checkbox" id="auto-mod" name="auto-mod">
                                <div class="setting-help">Automatically moderate spam, inappropriate content, and more</div>
                            </div>
                        </div>

                        <!-- Custom Commands -->
                        <div class="settings-card">
                            <h3>Custom Commands</h3>
                            <div class="setting-group">
                                <label for="custom-prefix">Custom Prefix</label>
                                <input type="text" id="custom-prefix" name="custom-prefix" 
                                    placeholder="Default: !">
                            </div>
                            <div class="setting-group">
                                <label for="custom-commands">Custom Commands</label>
                                <textarea id="custom-commands" name="custom-commands" rows="4" 
                                    placeholder="Format: command:response"></textarea>
                                <div class="setting-help">One command per line, format: command:response</div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-actions">
                        <button onclick="saveSettings()" class="save-button">Save Changes</button>
                    </div>
                </div>
            `;

            // Load channels for dropdowns
            loadChannels();
            loadRoles();
            loadCurrentSettings();
        }

        function loadChannels() {
            const token = localStorage.getItem('discord_access_token');
            const tokenType = localStorage.getItem('discord_token_type');
            const guildId = localStorage.getItem('selected_guild_id');

            fetch(`https://discord.com/api/guilds/${guildId}/channels`, {
                headers: {
                    Authorization: `${tokenType} ${token}`
                }
            })
            .then(response => response.json())
            .then(channels => {
                const textChannels = channels.filter(channel => channel.type === 0);
                const channelOptions = textChannels.map(channel => 
                    `<option value="${channel.id}">#${channel.name}</option>`
                ).join('');

                document.getElementById('welcome-channel').innerHTML = 
                    '<option value="">Select a channel</option>' + channelOptions;
                document.getElementById('mod-log-channel').innerHTML = 
                    '<option value="">Select a channel</option>' + channelOptions;
            })
            .catch(error => console.error('Error loading channels:', error));
        }

        function loadRoles() {
            const token = localStorage.getItem('discord_access_token');
            const tokenType = localStorage.getItem('discord_token_type');
            const guildId = localStorage.getItem('selected_guild_id');

            fetch(`https://discord.com/api/guilds/${guildId}/roles`, {
                headers: {
                    Authorization: `${tokenType} ${token}`
                }
            })
            .then(response => response.json())
            .then(roles => {
                const roleOptions = roles
                    .filter(role => role.name !== '@everyone')
                    .map(role => `<option value="${role.id}">${role.name}</option>`)
                    .join('');

                document.getElementById('autorole-roles').innerHTML = roleOptions;
            })
            .catch(error => console.error('Error loading roles:', error));
        }

        function loadCurrentSettings() {
            // Here you would load the current settings from your backend
            // For now, we'll just simulate it
            console.log('Loading current settings...');
        }

        function saveSettings() {
            // Collect all settings
            const settings = {
                welcomeEnabled: document.getElementById('welcome-enabled').checked,
                welcomeChannel: document.getElementById('welcome-channel').value,
                welcomeMessage: document.getElementById('welcome-message').value,
                autoroleEnabled: document.getElementById('autorole-enabled').checked,
                autoroleRoles: Array.from(document.getElementById('autorole-roles').selectedOptions).map(opt => opt.value),
                modLogChannel: document.getElementById('mod-log-channel').value,
                autoMod: document.getElementById('auto-mod').checked,
                customPrefix: document.getElementById('custom-prefix').value,
                customCommands: document.getElementById('custom-commands').value
            };

            // Here you would send these settings to your backend
            console.log('Saving settings:', settings);

            // Show success message
            const successMsg = document.createElement('div');
            successMsg.className = 'success-message';
            successMsg.textContent = 'Settings saved successfully!';
            document.querySelector('.settings-actions').appendChild(successMsg);

            // Remove success message after 3 seconds
            setTimeout(() => successMsg.remove(), 3000);
        }

        function checkAuth() {
            const token = localStorage.getItem('discord_access_token');
            const tokenType = localStorage.getItem('discord_token_type');
            const guildId = localStorage.getItem('selected_guild_id');

            if (!token || !tokenType || !guildId) {
                window.location.href = 'dashboard.html';
                return;
            }

            // Fetch guild data
            fetch(`https://discord.com/api/guilds/${guildId}`, {
                headers: {
                    Authorization: `${tokenType} ${token}`
                }
            })
            .then(response => response.json())
            .then(guildData => {
                if (guildData.id) {
                    showGuildSettings(guildData);
                } else {
                    throw new Error('Invalid guild data');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                window.location.href = 'dashboard.html';
            });
        }

        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', checkAuth);
    </script>
</body>
</html> 